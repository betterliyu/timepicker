!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e.bwidget=e.bwidget||{},e.bwidget.timepicker=t())}(this,function(){"use strict";function e(e,a){function u(e){var t,n,r;n=S.partial[S.selection],r="up"===e?n>=(0===S.selection?S.max:59)?0:n+1:n<=0?0===S.selection?S.max:59:n-1,S.partial[S.selection]=r,t=S.partial.join(":"),v.second=v.text2Second(t)}function d(e){var t,n;+(n=S.partial[S.selection]+e)>(0===S.selection?S.max:59)&&(n=e),S.partial[S.selection]=+n,t=S.partial.join(":"),v.second=v.text2Second(t)}function m(){var e=S.element.querySelector(".input"),t=S.colons;0===S.selection?n(e,0,t[0]):1===S.selection?n(e,t[0]+1,2):n(e,t[1]+1,2)}function f(e){var n=S.element.querySelector(".input");e.preventDefault();var r=t(n);"hh:mm:ss"===S.type?r<=S.colons[0]?S.selection=0:r>S.colons[0]&&r<=S.colons[1]?S.selection=1:S.selection=2:S.selection=r<=S.colons[0]?0:1,m()}function h(e){var t,n,r,o=S.element.querySelector(".input");if(e.preventDefault(),window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&e.isComposing)return!1;"hh:mm:ss"===S.type?b.test(o.value)?(t=o.value.match(b),n=0===S.selection?t[1][0]:1===S.selection?t[2][0]:t[3][0],r=S.second,d(n),S.onInput({preValue:r,newValue:S.second})):v.second=S.second:x.test(o.value)?(t=o.value.match(x),n=0===S.selection?t[1][0]:t[2][0],r=S.second,d(n),S.onInput({preValue:r,newValue:S.second})):v.second=S.second,setTimeout(function(){m()},0)}function p(e){var t,n={left:37,up:38,right:39,down:40};e.preventDefault(),e.keyCode===n.left||e.keyCode===n.right?"hh:mm:ss"===S.type?0===S.selection?S.selection=e.keyCode===n.left?2:1:1===S.selection?S.selection=e.keyCode===n.left?0:2:S.selection=e.keyCode===n.left?1:0:S.selection=0===S.selection?1:0:e.keyCode===n.up||e.keyCode===n.down?(t=S.second,u(e.keyCode===n.up?"up":"down"),S.onInput({preValue:t,newValue:S.second})):-1!==["0","1","2","3","4","5","6","7","8","9"].indexOf(e.key)?(t=S.second,d(e.key),S.onInput({preValue:t,newValue:S.second})):v.second=S.second,m()}function g(){m()}function w(e){if(S.disabled)return!1;var t=S.second;u(e.currentTarget.classList.contains("up")?"up":"down"),S.onInput({preValue:t,newValue:S.second})}var v=this,x=/^(\d+):(\d+)$/,b=/^(\d+):(\d+):(\d+)$/,y=document.querySelector(e),S={element:y,second:0,format:"hh(23):mm:ss",type:"hh:mm:ss",text:"00:00:00",width:"100%",height:"100%",align:"left",selection:0,disabled:!1,onInput:function(){},onValueChanged:function(){}};return y.innerHTML='<div class="bw-timepicker"><div class="input-wrap"><input class="input" type="text" onpaste="return false;" oncontextmenu="return false;" ondrop="return false;" ></div><div class="arrow-wrap"><div class="arrow up"><i></i></div><div class="arrow down"><i></i></div></div></div>',y.classList.add("bw-timepicker-wrap"),Object.defineProperties(v,{element:{configurable:!1,enumerable:!0,get:function(){return S.element}},second:{configurable:!1,enumerable:!0,get:function(){return S.second},set:function(e){if(!o(e))throw new Error("second must be a integer");var t,n=this.second2Text(e);S.second=e,S.element.querySelector(".input").value=n,"hh:mm:ss"===S.type?(S.colons=[S.max.toString().length,S.max.toString().length+3],t=n.match(b),S.partial=[+t[1],+t[2],+t[3]]):(S.colons=[S.max.toString().length],t=n.match(x),S.partial=[+t[1],+t[2]])}},width:{configurable:!1,enumerable:!0,get:function(){return S.width},set:function(e){if(o(e))S.width=e+"px";else{if(!r(e))throw new Error("width is not valid");S.width=e}S.element.style.width=e}},height:{configurable:!1,enumerable:!0,get:function(){return S.height},set:function(e){if(o(e))S.height=e+"px";else{if(!r(e))throw new Error("height is not valid");S.height=e}S.element.style.height=e}},align:{configurable:!1,enumerable:!0,get:function(){return S.align},set:function(e){if(!(r(e)&&["left","center","right"].indexOf(e.toLowerCase())>-1))throw new Error("align is not valid");S.align=e.toLowerCase(),S.element.querySelector(".input").style.textAlign=e.toLowerCase()}},disabled:{configurable:!1,enumerable:!0,get:function(){return S.disabled},set:function(e){S.disabled=!!e,e?(this.element.querySelector(".bw-timepicker").classList.add("bw-timepicker-disabled"),this.element.querySelector(".input").disabled=!0,this.element.querySelector(".arrow.up").removeEventListener("click",w),this.element.querySelector(".arrow.down").removeEventListener("click",w)):(this.element.querySelector(".bw-timepicker").classList.remove("bw-timepicker-disabled"),this.element.querySelector(".input").removeAttribute("disabled"),this.element.querySelector(".arrow.up").addEventListener("click",w),this.element.querySelector(".arrow.down").addEventListener("click",w))}},format:{configurable:!1,enumerable:!0,get:function(){return S.format}},max:{configurable:!1,enumerable:!0,get:function(){return S.max}},onInput:{configurable:!1,enumerable:!0,get:function(){return S.onInput},set:function(e){if(!i(e))throw new Error("onInput is not a function");S.onInput=e}},onValueChanged:{configurable:!1,enumerable:!0,get:function(){return S.onValueChanged},set:function(e){if(!i(e))throw new Error("onValueChanged is not a function");S.onValueChanged=e}}}),function(e){var t;if(r(e.format))if(s.test(e.format))null==(t=e.format.match(s))[2]?(S.max=23,e.format="hh(23):mm:ss"):S.max=+t[2],S.format=e.format,S.type="hh:mm:ss";else if(c.test(e.format))null==(t=e.format.match(c))[2]?(S.max=23,e.format="hh(23):mm"):S.max=+t[2],S.format=e.format,S.type="hh:mm";else{if(!l.test(e.format))throw new Error("format is not valid");null==(t=e.format.match(l))[2]?(S.max=59,e.format="mm(59):ss"):S.max=+t[2],S.format=e.format,S.type="mm:ss"}o(e.second)&&(v.second=e.second),(o(e.width)||r(e.width))&&(v.width=e.width),(o(e.height)||r(e.height))&&(v.height=e.height),r(e.align)&&(v.align=e.align),v.disabled=!!e.disabled,i(e.onInput)&&(v.onInput=e.onInput),i(e.onValueChanged)&&(v.onValueChanged=e.onValueChanged)}(a),function(){var e=S.element.querySelector(".input");e.addEventListener("mouseup",f),e.addEventListener("keydown",p),e.addEventListener("keyup",g),e.addEventListener("input",h),S.element.querySelector(".arrow.up").addEventListener("click",w),S.element.querySelector(".arrow.down").addEventListener("click",w)}(),v}function t(e){var t=0;if("selectionStart"in e)t=e.selectionStart;else if("selection"in document){e.focus();var n=document.selection.createRange(),r=document.selection.createRange().text.length;n.moveStart("character",-e.value.length),t=n.text.length-r}return t}function n(e,t,n){if(e.setSelectionRange)e.setSelectionRange(t,t+n);else if(e.createTextRange){var r=e.createTextRange();r.collapse(!0),r.moveStart("character",t),r.moveEnd("character",t+n),r.select()}else e.selectionStart&&(e.selectionStart=t,e.selectionEnd=t+n);e.focus()}function r(e){return"[object String]"===Object.prototype.toString.call(e)}function o(e){return"[object Number]"===Object.prototype.toString.call(e)&&parseInt(e)===e}function i(e){return"[object Function]"===Object.prototype.toString.call(e)}function a(e,t){return(Array(t).join(0)+e).slice(-t)}var s=/^hh(\((\d+)\))?:mm:ss$/,c=/^hh(\((\d+)\))?:mm$/,l=/^mm(\((\d+)\))?:ss$/;return e.prototype.text2Second=function(e){var t,n=/^(\d+):(\d+)$/,o=/^(\d+):(\d+):(\d+)$/;if(!r(e))throw new Error("arg must be string");if(o.test(e)){if(+(t=e.match(o))[1]>this.max)throw new Error("first exceeds the maximum");if(+t[2]>59)throw new Error("second exceeds the maximum");if(+t[3]>59)throw new Error("third exceeds the maximum");return+t[3]+60*(+t[2]+60*+t[1])}if(n.test(e)){if(+(t=e.match(n))[1]>this.max)throw new Error("first value exceeds the maximum");if(+t[2]>59)throw new Error("second value exceeds the maximum");return+t[2]+60*+t[1]}throw new Error("arg format is not valid")},e.prototype.second2Text=function(e){var t,n,r;if(e<0)throw new Error("arg can not be negative");if(s.test(this.format)){if(r=e%60,n=(e-r)/60%60,(t=parseInt(e/3600))>this.max)throw new Error("hour exceeds the maximum");return[a(t,this.max.toString().length),a(n,2),a(r,2)].join(":")}if(c.test(this.format)||l.test(this.format)){if(n=e%60,(t=parseInt(e/60))>this.max)throw new Error("exceeds the maximum");return[a(t,this.max.toString().length),a(n,2)].join(":")}},e});
